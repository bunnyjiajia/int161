‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‚ù§Ô∏è
‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏™‡∏≠‡∏ô **‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ JWT ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î** ‡πÅ‡∏•‡∏∞ **‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏™‡∏≠‡∏ö INT161 ‡∏ï‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**
‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ JWT ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

---

# üéØ **JWT ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô Backend?**

JWT = JSON Web Token
‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‚Äú‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô endpoint ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‚Äù

‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Üí server ‡∏™‡∏£‡πâ‡∏≤‡∏á token ‚Üí ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ client
‡∏ï‡πà‡∏≠‡∏°‡∏≤ client ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á token ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á protected

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ä‡πâ JWT ‡∏°‡∏µ 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÜ

# 1) Login ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á Token

# 2) ‡∏™‡πà‡∏á Token ‡πÑ‡∏õ‡πÉ‡∏ô Header

# 3) Middleware ‡∏ï‡∏£‡∏ß‡∏à Token ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ API

---

# ‚≠ê ‡πÉ‡∏ä‡πâ JWT ‡∏¢‡∏±‡∏á‡πÑ‡∏á? (‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á)

## ‚úî ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‚Äî ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á JWT

```bash
npm install jsonwebtoken
```

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‚Äî Login ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á Token

(‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô service ‡∏Ç‡∏≠‡∏á login)

üëâ ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå INT161 ‡∏≠‡∏≠‡∏Å‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞

```js
const jwt = require("jsonwebtoken");

async login(db, body) {
  const user = await db.user.findUnique({
    where: { email: body.email }
  });

  if (!user) 
    throw { status: 401, message: "invalid credentials" };

  if (user.password !== body.password)
    throw { status: 401, message: "invalid credentials" };

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á token
  const token = jwt.sign(
    { id: user.id, role: user.role },
    "secret123",            // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏ö
    { expiresIn: "1h" }     // ‡∏≠‡∏≤‡∏¢‡∏∏ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
  );

  return token;
}
```

üíõ **‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏î‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢:**

```
jwt.sign(payload, secret, options)
```

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 ‚Äî ‡∏™‡πà‡∏á Token ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô Controller

```js
res.json({ token });
```

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4 ‚Äî ‡πÉ‡∏´‡πâ client ‡∏™‡πà‡∏á token ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤

‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ protected ‡πÄ‡∏ä‡πà‡∏ô `/profile`
‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á header:

```
Authorization: Bearer <token>
```

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5 ‚Äî Middleware ‡∏ï‡∏£‡∏ß‡∏à Token

(‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏™‡∏≠‡∏ö‡∏ä‡∏±‡∏ß‡∏£‡πå)

```js
const jwt = require("jsonwebtoken");

function auth(req, res, next) {
  try {
    const header = req.headers.authorization;
    if (!header)
      throw { status: 401, message: "no token" };

    const token = header.split(" ")[1]; // ‡∏î‡∏∂‡∏á token ‡∏´‡∏•‡∏±‡∏á Bearer

    const decoded = jwt.verify(token, "secret123");

    req.user = decoded; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user
    next(); // ‡∏ú‡πà‡∏≤‡∏ô ‡∏•‡∏∏‡∏¢‡∏ï‡πà‡∏≠
  } catch (err) {
    res.status(401).json({ error: "invalid token" });
  }
}

module.exports = auth;
```

üíõ **‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏î‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:**

```
1) ‡∏≠‡πà‡∏≤‡∏ô header  
2) ‡πÅ‡∏¢‡∏Å token  
3) jwt.verify  
4) ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô ‚Üí next()  
5) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí 401
```

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 6 ‚Äî ‡πÉ‡∏ä‡πâ Middleware ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô API

‡πÉ‡∏ô route

```js
const auth = require("../middlewares/auth");

router.get("/profile", auth, controller.getProfile);
```

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ `/profile` ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ token ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ

---

# ‚≠ê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 7 ‚Äî ‡πÉ‡∏ä‡πâ role (‡πÄ‡∏™‡∏£‡∏¥‡∏°)

```js
function role(requiredRole) {
  return (req, res, next) => {
    if (req.user.role !== requiredRole)
      return res.status(403).json({ error: "forbidden" });

    next();
  };
}
```

‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

```js
router.delete("/adminOnly", auth, role("ADMIN"), controller.deleteUser);
```

---

# üéâ ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

## 1) Login ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á token

```js
const token = jwt.sign({id,role}, "secret", {expiresIn:"1h"});
```

## 2) Client ‡∏™‡πà‡∏á token

```
Authorization: Bearer <token>
```

## 3) Middleware ‡∏ï‡∏£‡∏ß‡∏à token

```js
jwt.verify(token, "secret");
```

## 4) ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ

‡πÄ‡∏ä‡πá‡∏Ñ role ‡πÄ‡∏û‡∏¥‡πà‡∏°

---

# üí¨ ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏â‡∏±‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á:

üìå **‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πá‡∏° Login + JWT + Role-Based Auth**
üìå **‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ô ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô CRUD ‡πÄ‡∏î‡∏¥‡∏°**
üìå **‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö Student API ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ**

‡πÅ‡∏Ñ‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤:

üëâ **‚Äú‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Auth ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞‚Äù**
