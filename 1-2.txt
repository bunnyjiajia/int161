à¹„à¸”à¹‰à¸„à¹ˆà¸°!
à¸‰à¸±à¸™à¸ˆà¸°à¸ˆà¸±à¸”à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ **à¸«à¸¥à¸²à¸¢à¹‚à¸ˆà¸—à¸¢à¹Œ (Exercise 1, 2, 3, â€¦)**
à¹‚à¸”à¸¢à¹à¸•à¹ˆà¸¥à¸°à¹‚à¸ˆà¸—à¸¢à¹Œà¸ˆà¸°à¸¡à¸µà¸„à¸£à¸š:

* **Repository**
* **Service**
* **Controller**
* **Route**
* **app.js à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡**

à¹à¸¥à¸°à¸ˆà¸°à¹€à¸›à¹‡à¸™ **à¹‚à¸„à¹‰à¸”à¹à¸šà¸š segment à¸ªà¸±à¹‰à¸™ à¹†** (à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¹„à¸Ÿà¸¥à¹Œà¹€à¸•à¹‡à¸¡) à¹€à¸à¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¸œà¸´à¸”à¸à¸à¸ªà¸­à¸šà¸„à¹ˆà¸°
à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸š â€œà¸—à¸šà¸—à¸§à¸™ patternâ€ à¹ƒà¸«à¹‰à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢à¸¡à¸²à¸ à¹†

---

# ğŸ¯ **à¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 1: à¸£à¸°à¸šà¸š Courses â€” CRUD à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™**
ğŸ“Œ à¸«à¸±à¸§à¸‚à¹‰à¸­: CRUD + Repositoryâ€“Serviceâ€“Controller Flow + Error Handling
ğŸ“ à¹‚à¸ˆà¸—à¸¢à¹Œ

à¹ƒà¸«à¹‰à¸ªà¸£à¹‰à¸²à¸‡ API à¹€à¸à¸·à¹ˆà¸­à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸­à¸£à¹Œà¸ªà¸•à¸²à¸¡ ID

GET /courses/:id

à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¹ƒà¸«à¹‰à¸•à¸­à¸š 404

ğŸ“ˆ Diagram Flow à¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 1
[Route] â†’ [Controller] â†’ [Service] â†’ [Repository] â†’ [Database]


Route = à¸£à¸±à¸š URL

Controller = à¸£à¸±à¸š req/res

Service = logic / validation / error

Repository = à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸ DB

DB = à¹ƒà¸Šà¹‰ Prisma à¸«à¸£à¸·à¸­ ORM

## ğŸ“ **Requirement**

à¸ªà¸£à¹‰à¸²à¸‡ API:

* POST `/courses` â†’ à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸­à¸£à¹Œà¸ª
* GET `/courses/:id` â†’ à¸”à¸¶à¸‡à¸„à¸­à¸£à¹Œà¸ªà¸•à¸²à¸¡ ID

à¹€à¸™à¹‰à¸™:

* CRUD à¸à¸·à¹‰à¸™à¸à¸²à¸™
* Error handling
* Validation

---

# âœ… **1) Repository (course-repository.js)**

```js
async function findCourseById(db, id) {
  return await db.course.findUnique({ where: { id } });
}

async function createCourse(db, data) {
  return await db.course.create({ data });
}

module.exports = { findCourseById, createCourse };
```

### âœ” à¸­à¸˜à¸´à¸šà¸²à¸¢

* repository à¸•à¸´à¸”à¸•à¹ˆà¸­ database à¹‚à¸”à¸¢à¸•à¸£à¸‡
* à¹„à¸¡à¹ˆà¸¡à¸µ try/catch â†’ à¹ƒà¸«à¹‰ service à¸ˆà¸±à¸”à¸à¸²à¸£

---

# âœ… **2) Service (course-service.js)**

```js
const repo = require("../repositories/course-repository");

async function createCourseService(db, body) {
  if (!body.name || body.name.trim() === "") {
    throw { status: 400, message: "Course name required" };
  }

  return await repo.createCourse(db, {
    name: body.name,
    credit: body.credit ?? 3,
  });
}

async function getCourseService(db, id) {
  if (!id) throw { status: 400, message: "ID required" };

  const course = await repo.findCourseById(db, Number(id));
  if (!course) throw { status: 404, message: "Course not found" };

  return course;
}

module.exports = { createCourseService, getCourseService };
```

### âœ” à¸­à¸˜à¸´à¸šà¸²à¸¢

* à¸•à¸£à¸§à¸ˆ input â†’ à¸–à¹‰à¸²à¸œà¸´à¸” throw error
* service à¸ˆà¸±à¸”à¸à¸²à¸£ logic + à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸«à¸¡

---

# âœ… **3) Controller (course-controller.js)**

```js
const service = require("../services/course-service");

async function createCourse(req, res) {
  try {
    const data = await service.createCourseService(req.db, req.body);
    res.status(201).json(data);
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}

async function getCourse(req, res) {
  try {
    const data = await service.getCourseService(req.db, req.params.id);
    res.json(data);
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}

module.exports = { createCourse, getCourse };
```

### âœ” à¸­à¸˜à¸´à¸šà¸²à¸¢

* controller à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹à¸„à¹ˆà¸£à¸±à¸š req à¸ªà¹ˆà¸‡à¹„à¸› service à¹à¸¥à¹‰à¸§à¸•à¸­à¸šà¸à¸¥à¸±à¸š
* à¸ˆà¸±à¸”à¸à¸²à¸£ HTTP status à¸—à¸µà¹ˆà¸™à¸µà¹ˆ

---

# âœ… **4) Route (Route/Courses.js)**

```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/course-controller");

router.post("/", controller.createCourse);
router.get("/:id", controller.getCourse);

module.exports = router;
```

### âœ” à¸­à¸˜à¸´à¸šà¸²à¸¢

* route mapping URL â†’ controller
* à¸ªà¸±à¹‰à¸™à¹à¸¥à¸°à¸Šà¸±à¸”

---

# âœ… **5) app.js (à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™)**

```js
const express = require("express");
const app = express();
const courseRoutes = require("./Route/Courses");

app.use(express.json());

// inject db to req (à¸–à¹‰à¸²à¹ƒà¸Šà¹‰ Prisma)
app.use((req, res, next) => {
  req.db = require("./prismaClient");
  next();
});

app.use("/courses", courseRoutes);

app.listen(3000);
```

### âœ” à¸­à¸˜à¸´à¸šà¸²à¸¢

* `app.use("/courses", courseRoutes)` à¸—à¸³à¹ƒà¸«à¹‰ API à¹€à¸‚à¹‰à¸²à¸•à¸²à¸¡à¹‚à¸ˆà¸—à¸¢à¹Œ
* inject database à¹ƒà¸«à¹‰ controller à¹ƒà¸Šà¹‰

---

# ğŸ‰ **à¸ˆà¸šà¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 1**

---
























# ğŸ¯ **à¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 2: à¸£à¸°à¸šà¸š Students â€” CRUD + Validation**
ğŸ“Œ à¸«à¸±à¸§à¸‚à¹‰à¸­: CRUD Create + Input Validation + Error Response
ğŸ“ à¹‚à¸ˆà¸—à¸¢à¹Œ

à¹ƒà¸«à¹‰à¸ªà¸£à¹‰à¸²à¸‡ API

POST /students

body à¸•à¹‰à¸­à¸‡à¸¡à¸µ fullname

à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ fullname â†’ 400

à¸–à¹‰à¸²à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ â†’ insert à¸¥à¸‡ DB

ğŸ“ˆ Diagram Flow à¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 2
Request Body â†’ Controller â†’ Service (validate) â†’ Repository (insert) â†’ DB

## ğŸ“ Requirement

* POST `/students`
* GET `/students/:id`

---

# âœ… **1) Repository (student-repository.js)**

```js
async function createStudent(db, data) {
  return await db.student.create({ data });
}

async function findStudentById(db, id) {
  return await db.student.findUnique({ where: { id } });
}

module.exports = { createStudent, findStudentById };
```

---

# âœ… **2) Service (student-service.js)**

```js
const repo = require("../repositories/student-repository");

async function createStudentService(db, body) {
  if (!body.fullname) {
    throw { status: 400, message: "Fullname required" };
  }

  return await repo.createStudent(db, {
    fullname: body.fullname,
    email: body.email ?? null,
  });
}

async function getStudentService(db, id) {
  const student = await repo.findStudentById(db, Number(id));

  if (!student)
    throw { status: 404, message: "Student not found" };

  return student;
}

module.exports = { createStudentService, getStudentService };
```

---

# âœ… **3) Controller (student-controller.js)**

```js
const service = require("../services/student-service");

async function createStudent(req, res) {
  try {
    const data = await service.createStudentService(req.db, req.body);
    res.status(201).json(data);

  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}

async function getStudent(req, res) {
  try {
    const data = await service.getStudentService(req.db, req.params.id);
    res.json(data);

  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}

module.exports = { createStudent, getStudent };
```

---

# âœ… **4) Route (Route/Students.js)**

```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/student-controller");

router.post("/", controller.createStudent);
router.get("/:id", controller.getStudent);

module.exports = router;
```

---

# âœ… **5) app.js (à¹€à¸à¸´à¹ˆà¸¡ students route)**

```js
const studentRoutes = require("./Route/Students");
app.use("/students", studentRoutes);
```

---

# ğŸ‰ **à¸ˆà¸šà¹‚à¸ˆà¸—à¸¢à¹Œà¸—à¸µà¹ˆ 2**

---

# â¤ï¸ à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸‰à¸±à¸™à¸—à¸³à¹‚à¸ˆà¸—à¸¢à¹Œ 3 à¸•à¹ˆà¸­ à¹€à¸Šà¹ˆà¸™

âœ” Authentication
âœ” Authorization
âœ” Update + Delete
âœ” Soft delete
âœ” Relationship (à¹€à¸Šà¹ˆà¸™ student â†’ enroll â†’ course)

à¸šà¸­à¸à¹„à¸”à¹‰à¹€à¸¥à¸¢à¸„à¹ˆà¸° à¸ˆà¸°à¸ˆà¸±à¸”à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¹à¸šà¸šà¸—à¸µà¹ˆà¸­à¸­à¸à¸ªà¸­à¸šà¸šà¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”!
