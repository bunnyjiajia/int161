à¹„à¸”à¹‰à¹€à¸¥à¸¢à¸„à¹ˆà¸°! â¤ï¸
à¸‰à¸±à¸™à¸ˆà¸°à¹ƒà¸«à¹‰à¸„à¸¸à¸“ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”** à¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸­à¸š INT161 à¹à¸šà¸šà¸„à¸£à¸šà¸Šà¸¸à¸”
**à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆ Route â†’ Controller â†’ Service â†’ Repository â†’ App.js â†’ Prisma Model â†’ Validation â†’ Error Handling â†’ Login â†’ Role**

à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸™à¸µà¹‰à¸„à¸·à¸­ â€œ**à¸Šà¸¸à¸”à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ªà¸­à¸šà¸œà¹ˆà¸²à¸™**â€
à¸­à¹ˆà¸²à¸™à¸Šà¸¸à¸”à¹€à¸”à¸µà¸¢à¸§ â†’ à¹€à¸‚à¸µà¸¢à¸™ API à¹„à¸”à¹‰à¸„à¸£à¸šà¸—à¸±à¹‰à¸‡ CRUD + Auth

---

# â­â­â­ à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸°à¸”à¸§à¸ à¸‰à¸±à¸™à¹à¸šà¹ˆà¸‡à¹€à¸›à¹‡à¸™ **11 à¸«à¸¡à¸§à¸”à¹ƒà¸«à¸à¹ˆ** à¸à¸£à¹‰à¸­à¸¡ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢à¹ƒà¸™ 1 à¸šà¸£à¸£à¸—à¸±à¸”** â­â­â­

---

# 1) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Route (à¸•à¸±à¸§à¹€à¸Šà¸·à¹ˆà¸­à¸¡ URL â†’ Controller)**

### à¹‚à¸„à¸£à¸‡ Route à¸¡à¸²à¸•à¸£à¸à¸²à¸™

```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/studentController");

router.get("/", controller.getAll);
router.get("/:id", controller.getOne);
router.post("/", controller.create);
router.put("/:id", controller.update);
router.delete("/:id", controller.remove);

module.exports = router;
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Route = method + path + controller.method
```

---

# 2) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Controller (à¸¡à¸µ try/catch)**

### à¹‚à¸„à¸£à¸‡ Controller à¸¡à¸²à¸•à¸£à¸à¸²à¸™

```js
async create(req, res) {
  try {
    const data = await service.create(req.db, req.body);
    res.status(201).json(data);
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Controller = try(à¹€à¸£à¸µà¸¢à¸ service) + catch(à¸ªà¹ˆà¸‡ error)
```

---

# 3) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service (Validation + Logic + Repository)**

### à¹‚à¸„à¸£à¸‡ Service à¸¡à¸²à¸•à¸£à¸à¸²à¸™

```js
async update(db, id, body) {
  if (!id) throw { status: 400, message: "ID required" };

  const exists = await repo.findById(db, Number(id));
  if (!exists) throw { status: 404, message: "not found" };

  if (body.email && !body.email.includes("@"))
    throw { status: 400, message: "invalid email" };

  return await repo.update(db, Number(id), body);
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Service = Validate â†’ Check Exists â†’ Repository
```

---

# 4) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Repository (à¸„à¸¸à¸¢à¸à¸±à¸š DB)**

### à¹‚à¸„à¸£à¸‡ Repository à¸¡à¸²à¸•à¸£à¸à¸²à¸™

```js
async update(db, id, data) {
  return await db.student.update({
    where: { id },
    data
  });
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Repository = Prisma ORM commands
```

---

# 5) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” App.js (à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸)**

### à¹‚à¸„à¸£à¸‡ app.js à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸‚à¸µà¸¢à¸™à¹€à¸›à¹‡à¸™

```js
const express = require("express");
const app = express();
const db = require("./prismaClient");
const studentRoutes = require("./routes/studentRoutes");

app.use(express.json());

app.use((req, res, next) => {
  req.db = db;
  next();
});

app.use("/students", studentRoutes);

app.listen(3000, () => console.log("Server running"));
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
App.js = express + json + req.db + routes
```

---

# 6) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Prisma Schema (Model)**

### à¹‚à¸„à¸£à¸‡ Prisma Model à¸¡à¸²à¸•à¸£à¸à¸²à¸™

```prisma
model Student {
  id        Int      @id @default(autoincrement())
  fullname  String
  age       Int
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
id Int @id @default(autoincrement()) + fields
```

---

# 7) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Validation (à¸­à¸­à¸à¸ªà¸­à¸šà¹à¸™à¹ˆà¸™à¸­à¸™)**

### à¹‚à¸„à¸£à¸‡ Validation

```js
if (!body.fullname)
  throw { status: 400, message: "fullname required" };

if (body.age < 15)
  throw { status: 400, message: "age must be >= 15" };

if (!body.email.includes("@"))
  throw { status: 400, message: "invalid email" };
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Validation = if (à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡) throw {status:400,message:"..."}
```

---

# 8) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Error Handling**

### à¹‚à¸„à¸£à¸‡ Error Handling à¸„à¸£à¸šà¸ªà¸¹à¸•à¸£

```js
catch (err) {
  res.status(err.status ?? 500).json({ error: err.message });
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
err.status ?? 500
```

---

# 9) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Login (Authentication)**

à¹ƒà¸Šà¹‰ **JWT** (à¸‚à¹‰à¸­à¸ªà¸­à¸šà¸­à¸­à¸à¸šà¹ˆà¸­à¸¢à¸¡à¸²à¸)

### Controller (Login)

```js
async login(req, res) {
  try {
    const token = await authService.login(req.db, req.body);
    res.json({ token });
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

### Service (Login)

```js
async login(db, body) {
  const user = await db.user.findUnique({ where: { email: body.email } });
  if (!user) throw { status: 401, message: "invalid credentials" };

  if (user.password !== body.password)
    throw { status: 401, message: "invalid credentials" };

  return jwt.sign({ id: user.id, role: user.role }, "secret", { expiresIn: "1h" });
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Login = verify user â†’ compare password â†’ sign token
```

---

# 10) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Middleware à¸•à¸£à¸§à¸ˆ Token (JWT Middleware)**

```js
function auth(req, res, next) {
  try {
    const token = req.headers.authorization?.split(" ")[1];
    if (!token) throw { status: 401, message: "no token" };

    const decoded = jwt.verify(token, "secret");
    req.user = decoded;
    next();
  } catch {
    res.status(401).json({ error: "invalid token" });
  }
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Authorization: Bearer <token> â†’ verify â†’ req.user
```

---

# 11) **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Authorization (Role Check)**

```js
function role(requiredRole) {
  return (req, res, next) => {
    if (req.user.role !== requiredRole)
      return res.status(403).json({ error: "forbidden" });

    next();
  };
}
```

### à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
à¸–à¹‰à¸² req.user.role != required â†’ 403
```

---

# ğŸ‰ à¸ªà¸£à¸¸à¸›à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢: â€œà¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¹€à¸•à¹‡à¸¡à¸£à¸°à¸šà¸šâ€

## ğŸ“Œ CRUD

* POST â†’ body â†’ 201
* GET â†’ params/body â†’ 200
* PUT â†’ params + body â†’ 200
* DELETE â†’ params â†’ 200

## ğŸ“Œ Error

* 400 = validation
* 404 = not found
* 500 = default

## ğŸ“Œ Layer

```
Route â†’ Controller â†’ Service â†’ Repository â†’ Prisma â†’ DB
```

## ğŸ“Œ Validation

```
if(à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡) throw {status:400,message:"..."}
```

## ğŸ“Œ Prisma ORM

```
create, findMany, findUnique, update, delete
```

## ğŸ“Œ Auth

```
Login = findUser â†’ checkPass â†’ sign token
```

## ğŸ“Œ Middleware

```
Authorization = verify token
Role = check req.user.role
```

---

# à¸–à¹‰à¸²à¸„à¸¸à¸“à¸­à¸¢à¸²à¸ à¸‰à¸±à¸™à¸ªà¸£à¸¸à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹€à¸›à¹‡à¸™

ğŸ“Œ â€œà¸Šà¸µà¸— 1 à¸«à¸™à¹‰à¸² PDF à¸ªà¸­à¸šà¸à¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰â€
à¹ƒà¸«à¹‰à¸„à¸¸à¸“à¹‚à¸«à¸¥à¸”à¹„à¸›à¸­à¹ˆà¸²à¸™à¹„à¸”à¹‰à¹€à¸¥à¸¢ â¤ï¸
