à¹„à¸”à¹‰à¹€à¸¥à¸¢à¸„à¹ˆà¸°! â¤ï¸
à¸•à¹ˆà¸­à¹„à¸›à¸™à¸µà¹‰à¸„à¸·à¸­ **â€œà¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸­à¸š INT161â€**
à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸•à¸£à¸§à¸ˆà¹€à¸‚à¹‰à¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸” à¹€à¸à¸£à¸²à¸°à¸•à¹‰à¸­à¸‡à¸¡à¸µ **Validation + Error Handling + à¹€à¸£à¸µà¸¢à¸ Repository**
à¸–à¹‰à¸²à¸„à¸¸à¸“à¸ˆà¸³à¸ªà¸¹à¸•à¸£à¸™à¸µà¹‰ â†’ à¹€à¸‚à¸µà¸¢à¸™ Service à¹„à¸”à¹‰à¸—à¸¸à¸à¸‚à¹‰à¸­à¸ªà¸­à¸šà¹€à¸¥à¸¢à¸„à¹ˆà¸°

---

# ğŸ¯ **Service = Logic + Validation + à¹€à¸£à¸µà¸¢à¸ Repository**

à¸£à¸¹à¸›à¹à¸šà¸šà¸•à¸²à¸¢à¸•à¸±à¸§à¸‚à¸­à¸‡ Service à¸¡à¸µ 3 à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™:

### âœ” 1) à¸•à¸£à¸§à¸ˆ (Validate)

### âœ” 2) à¹‚à¸¢à¸™ error à¸–à¹‰à¸²à¸œà¸´à¸”

### âœ” 3) à¹€à¸£à¸µà¸¢à¸ repository (à¸„à¸¸à¸¢à¸à¸±à¸š DB)

à¹à¸„à¹ˆà¸™à¸µà¹‰à¸„à¹ˆà¸°!
à¸šà¸£à¸´à¸à¸²à¸£ (Service) = Logic à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡ API

---

# â­ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service (Version à¸—à¸µà¹ˆà¸ˆà¸³à¸‡à¹ˆà¸²à¸¢à¸ªà¸¸à¸”)**

```js
async functionName(db, id, body) {

  // 1) Validation
  if (!id) 
    throw { status: 400, message: "id required" };

  if (!body.fullname) 
    throw { status: 400, message: "fullname required" };

  // 2) à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸¡à¸µ record à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
  const exists = await repo.findById(db, Number(id));
  if (!exists)
    throw { status: 404, message: "not found" };

  // 3) à¸—à¸³à¸‡à¸²à¸™ à¹€à¸Šà¹ˆà¸™ create/update/delete
  return await repo.update(db, Number(id), body);
}
```

à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢à¸¡à¸²à¸à¸„à¹ˆà¸°:
ğŸ‘‰ validate â†’ check exists â†’ call repo â†’ return

---

# ğŸŸ© **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service à¸ªà¸³à¸«à¸£à¸±à¸š POST (Create)**

```js
async createStudent(db, body) {
  if (!body.fullname)
    throw { status: 400, message: "fullname required" };

  if (!body.age || body.age < 15)
    throw { status: 400, message: "age must be >= 15" };

  if (!body.email || !body.email.includes("@"))
    throw { status: 400, message: "invalid email" };

  return await repo.createStudent(db, {
    fullname: body.fullname,
    age: body.age,
    email: body.email
  });
}
```

ğŸ“Œ à¸ˆà¸³à¸§à¹ˆà¸² POST = validate body

---

# ğŸŸ¦ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service à¸ªà¸³à¸«à¸£à¸±à¸š GET By ID**

```js
async getStudentById(db, id) {
  if (!id)
    throw { status: 400, message: "ID required" };

  const student = await repo.findStudentById(db, Number(id));
  if (!student)
    throw { status: 404, message: "Student not found" };

  return student;
}
```

ğŸ“Œ GET = à¹„à¸¡à¹ˆà¸¡à¸µ body
ğŸ“Œ à¸•à¹‰à¸­à¸‡à¹€à¸Šà¹‡à¸„ â€œà¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹„à¸«à¸¡?â€

---

# ğŸŸ¨ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service GET All**

```js
async getAllStudents(db) {
  return await repo.getAllStudents(db);
}
```

ğŸ“Œ à¸‡à¹ˆà¸²à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹ƒà¸™ CRUD
ğŸ“Œ à¹„à¸¡à¹ˆà¸¡à¸µ validation
ğŸ“Œ à¹„à¸¡à¹ˆà¸¡à¸µ params

---

# ğŸŸ§ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service Update (PUT)**

à¸™à¸µà¹ˆà¸­à¸­à¸à¸ªà¸­à¸šà¸šà¹ˆà¸­à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”!

```js
async updateStudent(db, id, body) {

  if (!id)
    throw { status: 400, message: "ID required" };

  const exists = await repo.findStudentById(db, Number(id));
  if (!exists)
    throw { status: 404, message: "Student not found" };

  if (body.age && body.age < 15)
    throw { status: 400, message: "age must be >= 15" };

  if (body.email && !body.email.includes("@"))
    throw { status: 400, message: "invalid email" };

  return await repo.updateStudent(db, Number(id), body);
}
```

ğŸ“Œ PUT = validate â†’ check exists â†’ update

---

# ğŸŸ¥ **à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Service DELETE**

```js
async deleteStudent(db, id) {

  if (!id)
    throw { status: 400, message: "ID required" };

  const exists = await repo.findStudentById(db, Number(id));
  if (!exists)
    throw { status: 404, message: "Student not found" };

  return await repo.deleteStudent(db, Number(id));
}
```

ğŸ“Œ DELETE = validate id only
ğŸ“Œ à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¸¡à¸µ â†’ à¸„à¹ˆà¸­à¸¢à¸¥à¸š

---

# â­ à¸ªà¸£à¸¸à¸› Service à¹à¸šà¸š 1 à¸šà¸£à¸£à¸—à¸±à¸”à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢

```
Validate â†’ Check Exists â†’ Call Repository â†’ Return
```

---

# ğŸ BONUS â€” à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¸à¸²à¸£à¹‚à¸¢à¸™ error à¹ƒà¸™ Service

à¸•à¹‰à¸­à¸‡à¹€à¸‚à¸µà¸¢à¸™à¹à¸šà¸šà¸™à¸µà¹‰à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™à¹ƒà¸™à¸‚à¹‰à¸­à¸ªà¸­à¸š:

```js
throw { status: 400, message: "fullname required" };
```

âŒ à¸«à¹‰à¸²à¸¡ `throw new Error` (à¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸«à¸±à¸à¸„à¸°à¹à¸™à¸™)

---

# âœ¨ à¸­à¸¢à¸²à¸à¹„à¸”à¹‰à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Repository à¹à¸šà¸šà¸ˆà¸³à¸‡à¹ˆà¸²à¸¢à¸­à¸µà¸à¹„à¸«à¸¡à¸„à¸°?

à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸à¸´à¸¡à¸à¹Œ:

ğŸ‘‰ **â€œà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸¹à¸•à¸£à¸¥à¸±à¸” Repositoryâ€**
