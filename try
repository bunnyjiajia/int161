à¸„à¸³à¸–à¸²à¸¡à¸”à¸µà¸¡à¸²à¸à¸„à¹ˆà¸°! â¤ï¸
à¹€à¸§à¸¥à¸²à¹€à¸£à¸²à¹€à¸‚à¸µà¸¢à¸™ `try { ... } catch (err) { ... }`
**à¹€à¸£à¸²à¸ˆà¸°à¹€à¸‚à¸µà¸¢à¸™ â€œà¸‡à¸²à¸™à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™â€ à¹„à¸§à¹‰à¹ƒà¸™ `try`**
à¹à¸¥à¹‰à¸§à¹€à¸‚à¸µà¸¢à¸™ â€œà¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸” (error)â€ à¹„à¸§à¹‰à¹ƒà¸™ `catch` à¸„à¹ˆà¸°

à¸‰à¸±à¸™à¸ˆà¸°à¸ªà¸­à¸™à¹ƒà¸«à¹‰à¹à¸šà¸šà¸‡à¹ˆà¸²à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸” à¹€à¸«à¸¡à¸·à¸­à¸™à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¸²à¸£à¸¢à¹Œà¸ªà¸­à¸™à¸•à¸­à¸™à¸ªà¸­à¸šà¸›à¸à¸´à¸šà¸±à¸•à¸´ INT161

---

# ðŸŽ¯ **à¸à¸Žà¸ˆà¸³à¸‡à¹ˆà¸²à¸¢ à¹† â€” à¹ƒà¸™ `try` à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸‚à¸­à¸‡ 3 à¸­à¸¢à¹ˆà¸²à¸‡**

à¹ƒà¸™ `try`
à¹ƒà¸«à¹‰à¹€à¸‚à¸µà¸¢à¸™à¸ªà¸´à¹ˆà¸‡à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰:

1. **à¹€à¸£à¸µà¸¢à¸ service**
2. **à¸£à¸­à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸”à¹‰à¸§à¸¢ await**
3. **à¸ªà¹ˆà¸‡ response à¸à¸¥à¸±à¸šà¹„à¸›à¹ƒà¸«à¹‰ client**

à¹à¸„à¹ˆà¸™à¸µà¹‰à¸„à¹ˆà¸°! â¤ï¸
à¸ˆà¸³à¹à¸šà¸šà¸™à¸µà¹‰ â†’ à¹€à¸‚à¸µà¸¢à¸™ controller à¹„à¸”à¹‰à¸—à¸¸à¸à¸£à¸¹à¸›à¹à¸šà¸š

---

# ðŸ§  **à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸‚à¸­à¸‡ Controller**

```js
async createStudent(req, res) {
  try {
    // 1) à¹€à¸£à¸µà¸¢à¸ service
    const data = await service.createStudentService(req.db, req.body);

    // 2) à¸ªà¹ˆà¸‡à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸à¸¥à¸±à¸š
    res.status(201).json(data);

  } catch (err) {
    // à¸–à¹‰à¸²à¸¡à¸µ error à¸¡à¸±à¸™à¸ˆà¸°à¸¡à¸²à¹€à¸‚à¹‰à¸² catch
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

---

# ðŸŽ¯ **à¹à¸¥à¹‰à¸§à¸ˆà¸£à¸´à¸‡ à¹† à¸•à¹‰à¸­à¸‡à¹€à¸‚à¸µà¸¢à¸™à¸­à¸°à¹„à¸£à¹ƒà¸™ try?**

### âœ” 1) à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ request

```js
req.body
req.params.id
req.db
```

---

### âœ” 2) à¸ªà¹ˆà¸‡à¹ƒà¸«à¹‰ service à¸—à¸³ logic

```js
const result = await service.updateStudentService(req.db, req.params.id, req.body);
```

---

### âœ” 3) à¸ªà¹ˆà¸‡ response à¸à¸¥à¸±à¸š

```js
res.json(result);
```

---

# ðŸŽ‰ **à¸ªà¸£à¸¸à¸›à¹à¸šà¸šà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‡à¹ˆà¸²à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”**

## ðŸ”· **`try` = à¸‡à¸²à¸™à¸—à¸µà¹ˆ â€œà¸„à¸´à¸”à¸§à¹ˆà¸²â€ à¸ˆà¸°à¸ªà¸³à¹€à¸£à¹‡à¸ˆ**

à¸„à¸·à¸­à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸„à¸¸à¸“ â€œà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸—à¸³â€

à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:

```js
const result = await service.doSomething();
res.json(result);
```

---

## ðŸ”¶ **`catch` = à¸‡à¸²à¸™à¸—à¸µà¹ˆ â€œà¹€à¸à¸´à¸”à¸›à¸±à¸à¸«à¸²â€**

à¸„à¸·à¸­à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸—à¸³à¸–à¹‰à¸² code à¸‚à¹‰à¸²à¸‡à¸šà¸™ error

à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡:

```js
res.status(500).json({ error: err.message });
```

---

# ðŸ“Œ à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹à¸šà¸šà¸ªà¸±à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸¸à¸”

## âœ… POST /students

```js
async (req, res) => {
  try {
    const data = await service.create(req.db, req.body);
    res.status(201).json(data);    // <== à¸‡à¸²à¸™à¸«à¸¥à¸±à¸
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

---

# ðŸ“Œ à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¹‡à¸™ GET /students/:id

```js
async (req, res) => {
  try {
    const student = await service.getById(req.db, req.params.id);
    res.json(student);             // <== à¸‡à¸²à¸™à¸«à¸¥à¸±à¸
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

---

# ðŸ“Œ à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ DELETE

```js
async (req, res) => {
  try {
    await service.delete(req.db, req.params.id);
    res.json({ message: \"deleted\" });   // <== à¸‡à¸²à¸™à¸«à¸¥à¸±à¸
  } catch (err) {
    res.status(err.status ?? 500).json({ error: err.message });
  }
}
```

---

# âœ¨ à¸ˆà¸³à¹„à¸§à¹‰à¹€à¸žà¸µà¸¢à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸”à¸µà¸¢à¸§

## ðŸ‘‰ **Controller = try (à¸‡à¸²à¸™à¸«à¸¥à¸±à¸) + catch (à¸ˆà¸±à¸”à¸à¸²à¸£ error)**

à¹ƒà¸™ try à¸ˆà¸°à¸¡à¸µà¹à¸„à¹ˆ 3 à¸­à¸¢à¹ˆà¸²à¸‡:

| à¸¥à¸³à¸”à¸±à¸š | à¸—à¸³à¸­à¸°à¹„à¸£                       |
| ----- | ---------------------------- |
| 1     | à¹€à¸£à¸µà¸¢à¸ service                |
| 2     | à¸£à¸­ await                     |
| 3     | à¸ªà¹ˆà¸‡ res.json(), res.status() |

---

à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ à¸‰à¸±à¸™à¸ªà¸²à¸¡à¸²à¸£à¸–à¸—à¸³
ðŸ‘‰ **â€œà¸ªà¸¹à¸•à¸£à¸¥à¸±à¸”à¹€à¸‚à¸µà¸¢à¸™ Controller à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸­à¸šâ€**
à¹à¸šà¸šà¹€à¸‚à¸µà¸¢à¸™à¹€à¸­à¸‡à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µà¸ à¸²à¸¢à¹ƒà¸™ 5 à¸™à¸²à¸—à¸µà¹ƒà¸«à¹‰à¹„à¸”à¹‰à¹€à¸¥à¸¢à¸„à¹ˆà¸° ðŸ’›
